<%- include('includes/_header') %>

<main id="main">
  <a href="/">
    <span><i class="fas fa-arrow-left"></i> All Drugs</span>
  </a>

  <h2>Add a Drug</h2>
  <p>Use the below form to add a new drug</p>

  <form id="addDrugForm">
    <div class="container d-flex flex-column align-items-stretch">

      <div class="row mb-3 form-group justify-content-center">             
        <label for="name" class="col-3 col-form-label">Drug Name</label>
        <input type="text" id="name" name="name" placeholder="Drug Name" class="col-md-4 col-xs-8" required>
      </div>

      <div class="row mb-3 form-group justify-content-center">
        <label for="card" class="col-3 col-form-label">Tablets per Card</label>
        <input type="number" id="card" name="card" placeholder="Tablets per Card" class="col-xs-8 col-md-4" required>
      </div>

      <div class="row mb-3 form-group justify-content-center">
        <label for="pack" class="col-3 col-form-label">Tablets per Pack</label>
        <input type="number" id="pack" name="pack" placeholder="Tablets per Pack" class="col-xs-8 col-md-4" required>
      </div>

      <div class="row form-group mb-3 justify-content-center">
        <label for="perDay" class="col-3 col-form-label">Taken per day</label>
        <input type="number" id="perDay" name="perDay" placeholder="Taken per day" class="col-xs-8 col-md-4" required>
      </div>

      <div class="row mb-3 form-group justify-content-center">             
        <label for="dosage" class="col-3 col-form-label">Dosage</label>
        <input type="text" id="dosage" name="dosage" placeholder="Dosage" class="col-md-4 col-xs-8" required>
      </div>

      <div class="form-group text-center">
        <button type="submit" class="btn btn-primary">Add Drug</button>
      </div>

    </div>
  </form>
</main>

<script>
  // Đảm bảo DOM đã load
  document.addEventListener("DOMContentLoaded", function() {
    const form = document.getElementById("addDrugForm");

    form.addEventListener("submit", async function(e) {
      e.preventDefault(); // Ngăn form submit mặc định

      const body = {
        name: document.getElementById("name").value,
        card: Number(document.getElementById("card").value),
        pack: Number(document.getElementById("pack").value),
        perDay: Number(document.getElementById("perDay").value),
        dosage: document.getElementById("dosage").value
      };

      try {
        const res = await fetch("/api/drugs", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });

        const result = await res.json();

        alert(result.message || "Drug added successfully!");
        window.location.href = "/manage";
      } catch (err) {
        console.error(err);
        alert("Error adding drug");
      }
    });
  });
</script>

<%- include('includes/_footer') %>

